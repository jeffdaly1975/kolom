#!/usr/bin/perl -w
#
# 2026-02-13 Feb.Fri 12:38:31 Calls kolam_worker_getKolamData.sh
#

use strict;
use warnings;
use bignum;


# usage: get_kolam_info.alchemy.pl TOKENID

# example:
#   get_kolam_info.alchemy.pl 98328815286472208108725841938299315763074621854053660676912324279791346200393


my $hexid=0;
my $input=0;

die "usage: $0 TOKENID" unless scalar(@ARGV)>0;

while (scalar(@ARGV)>0){
  my $input= shift @ARGV;

  if ($input =~ /^\s*(\d+)\s*$/){
   my $tokenid=Math::BigInt->new( $input ) || die "input must be a number";
   $hexid=sprintf("%064s", substr($tokenid->as_hex(),2));
   print "CONVERTED INPUT TOKEN ID [$input] to hex [$hexid]\n";
  }else{
   die "usage: TOKENID";
  }

# query the blockchain via alchemy 
my @output = qx{./kolam_worker_getKolamData.sh $hexid};
#print "GOT RESPONSE:\n"; print @output;

 # error checking from `perldoc -f qx`
 if ($? == -1) {
     die "failed to execute kolam_worker_getKolamData.sh $hexid: $!\n";
 }elsif ($? & 127) {
     printf STDERR "child died with signal %d, %s coredump\n",
     ($? & 127),  ($? & 128) ? 'with' : 'without';
 }elsif ($? == 0) {
   # success!
 }else{
     printf STDERR "child exited with value %d\n", $? >> 8;
 }

# OUTPUT:

#### [{"jsonrpc":"2.0","id":1,"result":"0x00000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000080000000000000000000000000620051b8553a724b742ae6ae9cc3585d29f4984800000000000000000000000000000000000000000000000000000000698f4c07000000000000000000000000000000000000000000000000000000000000001515f816f712e1a1c429fffff942e3a3c435f836f7300000000000000000000000"}]2026-02-13.Feb.Fri 12:49:16 [~/Downloads/NFTs/otom] % 
## "result":"0x0000000000000000000000000000000000000000000000000000000000000005 => 5 blobs of 64 hex
##             0000000000000000000000000000000000000000000000000000000000000080 => 128
##             000000000000000000000000620051b8553a724b742ae6ae9cc3585d29f49848 => wallet of discoverer
##             00000000000000000000000000000000000000000000000000000000698f4c07 => 1770998791 the date created
##             0000000000000000000000000000000000000000000000000000000000000015 => 21
##             15f816f712e1a1c429fffff942e3a3c435f836f7300000000000000000000000" => ?? 21 byte pairs? is this the cells content?
## 
## #(uint8)   : 5
## #(bytes)   : 0x15f816f712e1a1c429fffff942e3a3c435f836f730
## #(address) : 0x620051B8553a724b742ae6ae9cC3585d29F49848
## #(uint256) : 1770998791
## 

foreach my $line ( @output ){
print $line;
#   while ($line =~ /"id":(\d+),"result":"0x0{56}([0-9a-f]+)"/g ){
#      my ($this_id, $count) = ($1, eval "0x$2" );
#
#      die "invalid id $this_id" unless exists $idhash{$this_id};
#
#     printf ( "%-6.6s %8d\n", $idhash{$this_id}, $count );
#   }
}

}

__DATA__

 0x0000000000000000000000000000000000000000000000000000000000000008  => Does 8 mean Level 7 because this one is a level 7
   0000000000000000000000000000000000000000000000000000000000000080
   000000000000000000000000620051b8553a724b742ae6ae9cc3585d29f49848
   00000000000000000000000000000000000000000000000000000000698f45dd
   0000000000000000000000000000000000000000000000000000000000000039 => 57
   11311313113131312713131642427131642424242716424242424242f 42424242424283542424242831354242831313543131313313133133000000000000000


https://opensea.io/collection/kolam-official?traits=[{%22traitType%22:%22Pattern%20ID%22,%22values%22:[%22KL5-13-1-144f5900d6cc9872b8b98d50da%22]}]

  KL5-13-1-144f5900d6cc9872b8b98d50da
 
 TOKEN ID 9186452167828680613877029286270308408671432468473597291214368645437802975778
 [{"jsonrpc":"2.0","id":1,"result":"0x00000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000080000000000000000000000000620051b8553a724b742ae6ae9cc3585d29f4984800000000000000000000000000000000000000000000000000000000698e6c3f000000000000000000000000000000000000000000000000000000000000001f15f81aaa15fdfdf85fd9f9df82ff99f99ff46fb9f9bf76fbfbf73aaa36f73000"}]
 
 
 https://opensea.io/collection/kolam-official?traits=[{%22traitType%22:%22Pattern%20ID%22,%22values%22:[%22KL5-13-1-cf011868abfb7c2236f1ee7ad6%22]}]
  KL5-13-1-cf011868abfb7c2236f1ee7ad6
 
 TOKEN ID 93630694967659553896186501846102874673597104751551706123644874651728153583624
 [{"jsonrpc":"2.0","id":1,"result":"0x00000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000080000000000000000000000000620051b8553a724b742ae6ae9cc3585d29f4984800000000000000000000000000000000000000000000000000000000698e23d3000000000000000000000000000000000000000000000000000000000000001f15f81aaa12dfffd45b97a69b82ff99f99ff46d98a59d72bfffb43aaa36f73000"}]
 
 
 
 
 
 
 [{"jsonrpc":"2.0","id":1,"result":"0x0000000000000000000000000000000000000000000000000000000000000006 0000000000000000000000000000000000000000000000000000000000000080 000000000000000000000000620051b8553a724b742ae6ae9cc3585d29f49848 00000000000000000000000000000000000000000000000000000000698e6c3f 000000000000000000000000000000000000000000000000000000000000001f 15f81aaa1 5fdfdf85fd9f9df 82ff99f99ff46 fb9f9bf76fbfbf73 aaa36f73000"}]
 [{"jsonrpc":"2.0","id":1,"result":"0x0000000000000000000000000000000000000000000000000000000000000006 0000000000000000000000000000000000000000000000000000000000000080 000000000000000000000000620051b8553a724b742ae6ae9cc3585d29f49848 00000000000000000000000000000000000000000000000000000000698e23d3 000000000000000000000000000000000000000000000000000000000000001f 15f81aaa1 2dfffd45b97a69b 82ff99f99ff46 d98a59d72bfffb43 aaa36f73000"}]

tokenid: 99589083833255777439083005705891336049961223300231230855463869081891014306277
Level 4 bytes: 0x15d82fbf42bfdfb424cf9fe242dfbfd42fdf46b730
has 21 bytes for 25 dots
0x
15
d8
2f
bf
42
bf
df
b4
24
cf
9f
e2
42
df
bf
d4
2f
df
46
b7
30


tokenid: 7592627025258300706676117426611613616180721193166533695739360766294687486558
Level 5 bytes: 0x12f424324294129415b835b812ecfe0cfec436d716d732943294241242f430
has 31 bytes for 36 dots
0x
12
f4
24
32
42
94
12
94
15
b8
35
b8
12
ec
fe
0c
fe
c4
36
d7
16
d7
32
94
32
94
24
12
42
f4
30

tokenid: 77325398779956944887895326780795194099449524663069784942408779562183217079633
Level 6 bytes: 0x113113131271316424271642424242d42424242424024242424242b4242424283542428313543131331330
has 43 bytes for 49 dots
0x
11
31
13
13
12
71
31
64
24
27
16
42
42
42
42
d4
24
24
24
24
24
02
42
42
42
42
42
b4
24
24
24
28
35
42
42
83
13
54
31
31
33
13
30

function getRequiredBytes() takes input level (which is always 1 more than the actual level, so Level 4 you input 5) and outputs the number of bytes of data required to describe it?

Level | Bytes
   1  |    1
   2  |    3
   3  |    7
   4  |   13
   5  |   21
   6  |   31
   7  |   43
   8  |   57
   9  |   73
  10  |   91
  11  |  111
  12  |  133


WOAH function TokensOfOwner() returns the entire list of Kolams held by an address.


function TokenURI() takes a tokenid and returns the metadata i think. This could get me the information I need.
